from aiogram import types, Router, F
from aiogram.filters import Command
import asyncio

from keyboards.inline import (
    get_main_inline_keyboard, get_help_menu_keyboard, get_help_section_keyboard,
    HELP_MENU, HELP_USAGE, HELP_SEARCH, HELP_PROFILE, HELP_CHAT, BACK_TO_HELP, BACK_TO_MAIN
)

router = Router()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–µ–Ω—é –ø–æ–º–æ—â–∏
@router.message(Command("help"))
@router.message(F.text == "‚ÑπÔ∏è –ü–æ–º–æ—â—å")
@router.callback_query(F.data == HELP_MENU)
async def cmd_help(message_or_callback: types.Message | types.CallbackQuery):
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ callback
    is_callback = isinstance(message_or_callback, types.CallbackQuery)
    if is_callback:
        await message_or_callback.answer()
        message = message_or_callback.message
    else:
        message = message_or_callback

    help_text = (
        "ü§ñ –ë–æ—Ç –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤\n\n"
        "–ö–æ–º–∞–Ω–¥—ã:\n"
        "/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\n"
        "üîç –ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ - –ü–æ–∏—Å–∫ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞\n"
        "üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è\n"
        "‚ÑπÔ∏è –ü–æ–º–æ—â—å - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:"
    )

    if is_callback:
        await message.edit_text(help_text, reply_markup=get_help_menu_keyboard())
    else:
        await message.answer(help_text, reply_markup=get_help_menu_keyboard())

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –º–µ–Ω—é –ø–æ–º–æ—â–∏
@router.callback_query(F.data == BACK_TO_HELP)
async def back_to_help(callback: types.CallbackQuery):
    await callback.answer()
    await cmd_help(callback)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ –ø–æ–º–æ—â–∏
@router.callback_query(F.data.startswith("help_"))
async def process_help_sections(callback: types.CallbackQuery):
    section = callback.data.split("_")[1]
    await callback.answer()

    help_sections = {
        "usage": (
            "‚ùì –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º\n\n"
            "1. –ó–∞–ø–æ–ª–Ω–∏ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ\n"
            "2. –ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫—É 'üîç –ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞' –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ —á–∞—Ç–∞\n"
            "3. –û–±—â–∞–π—Å—è –∞–Ω–æ–Ω–∏–º–Ω–æ —Å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–º\n"
            "4. –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–µ—à—å —Ä–∞—Å–∫—Ä—ã—Ç—å —Å–≤–æ—é –ª–∏—á–Ω–æ—Å—Ç—å –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å —á–∞—Ç\n"
            "5. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ —Ä–∞–∑–¥–µ–ª 'üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å'\n"
            "6. –£–ø—Ä–∞–≤–ª—è–π —Å–≤–æ–µ–π –≤–∏–¥–∏–º–æ—Å—Ç—å—é —Å –ø–æ–º–æ—â—å—é —Å—Ç–∞—Ç—É—Å–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
        ),
        "search": (
            "üîç –ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞\n\n"
            "–ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É 'üîç –ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞' –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é.\n"
            "–ë–æ—Ç –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è.\n"
            "–ö–æ–≥–¥–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω, –≤—ã —Å–º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ.\n"
            "–ï—Å–ª–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω —Å—Ä–∞–∑—É, –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –ø–æ–∏—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.\n\n"
            "–í–∞–∂–Ω–æ: –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º üü¢ –ê–∫—Ç–∏–≤–µ–Ω –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–π–¥–µ–Ω—ã."
        ),
        "profile": (
            "üë§ –ü—Ä–æ—Ñ–∏–ª—å\n\n"
            "–í —Ä–∞–∑–¥–µ–ª–µ '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å' —Ç—ã –º–æ–∂–µ—à—å:\n"
            "- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ\n"
            "- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª—é–±—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ\n"
            "- –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é\n"
            "- –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\n\n"
            "–°—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:\n"
            "üü¢ –ê–∫—Ç–∏–≤–µ–Ω - –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –Ω–∞–π—Ç–∏ —Ç–µ–±—è\n"
            "üî¥ –ù–µ–∞–∫—Ç–∏–≤–µ–Ω - –¢—ã —Å–∫—Ä—ã—Ç –æ—Ç –ø–æ–∏—Å–∫–∞\n\n"
            "–ß–µ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω —Ç–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å, —Ç–µ–º –±–æ–ª—å—à–µ —à–∞–Ω—Å–æ–≤ –Ω–∞–π—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞!"
        ),
        "chat": (
            "üí¨ –ê–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç\n\n"
            "–í —á–∞—Ç–µ —Ç—ã –º–æ–∂–µ—à—å:\n"
            "- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n"
            "- –î–µ–ª–∏—Ç—å—Å—è —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏\n"
            "- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∏–∫–µ—Ä—ã\n\n"
            "–ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–æ–º:\n"
            "üëã –†–∞—Å–∫—Ä—ã—Ç—å –ª–∏—á–Ω–æ—Å—Ç—å - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É –Ω–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏\n"
            "‚ùå –ó–∞–≤–µ—Ä—à–∏—Ç—å —á–∞—Ç - –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —á–∞—Ç"
        )
    }

    await callback.message.edit_text(
        help_sections[section],
        reply_markup=get_help_section_keyboard()
    )